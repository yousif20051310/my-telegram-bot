from telegram import Update, ChatMember, InlineKeyboardMarkup, InlineKeyboardButton
from telegram.ext import ApplicationBuilder, MessageHandler, CommandHandler, CallbackQueryHandler, filters, ContextTypes

TOKEN = "8049811207:AAEi98HtcBtnaSbAcIQMw9UvLS0emxfqFXY"
CHANNEL_USERNAME = "@AhA_90"

async def is_user_subscribed(bot, user_id: int) -> bool:
    try:
        member = await bot.get_chat_member(CHANNEL_USERNAME, user_id)
        return member.status in [ChatMember.MEMBER, ChatMember.ADMINISTRATOR, ChatMember.OWNER]
    except Exception as e:
        print(f"Error checking subscription: {e}")
        return False

def decorate_arabic(text: str) -> list[str]:
    styles = [
        f"ã€{text}ã€", f"ï¸½{text}ï¸½", f"ã€Œ{text}ã€", f"Ù€{text}Ù€", f"ê§{text}ê§‚",
        f"â†«{text}â†¬", f"ã€ â˜… ã€{text}", f"â•­â”ˆâ”€â•®{text}â•°â”€â”ˆâ•¯", f"âœ¦ {text} âœ¦", f"â™¡{text}â™¡",
        f"â§¼{text}â§½", f"âŸ¦{text}âŸ§", f"âœ¿ {text} âœ¿", f"â€¢ {text} â€¢", f"â«·{text}â«¸"
    ]
    fancy_map = {
        "Ø§": "Ø¢", "Ø¨": "Ø¨Ù°", "Øª": "ØªÌ²", "Ø«": "Ø«Ù€", "Ø¬": "Ø¬Ù€", "Ø­": "Ø­Ù€", "Ø®": "Ø®Ì²",
        "Ø¯": "Ø¯Ù", "Ø°": "Ø°Ù°", "Ø±": "Ø±Ù", "Ø²": "Ø²Ù", "Ø³": "Ø³Ù‹", "Ø´": "Ø´Ù€", "Øµ": "ØµÙ°",
        "Ø¶": "Ø¶Ù", "Ø·": "Ø·Ù", "Ø¸": "Ø¸Ù‹", "Ø¹": "Ø¹Ù€", "Øº": "ØºÙ", "Ù": "ÙÙ°", "Ù‚": "Ù‚Ù",
        "Ùƒ": "ÙƒÙ°", "Ù„": "Ù„Ì²", "Ù…": "Ù…Ù€", "Ù†": "Ù†Ù°", "Ù‡": "Ù‡Ù€", "Ùˆ": "Ûˆ", "ÙŠ": "ÙŠÙ"
    }
    fancy_text = "".join(fancy_map.get(c, c) for c in text)
    styles.append(f"ğŸ€ {fancy_text} ğŸ€")
    return styles

def decorate_english(text: str) -> list[str]:
    styles = [
        f"ã€{text}ã€", f"ï¸½{text}ï¸½", f"ã€Œ{text}ã€", f"~{text}~", f"ê§{text}ê§‚",
        f"â†«{text}â†¬", f"ã€ â˜… ã€{text}", f"â•­â”ˆâ”€â•®{text}â•°â”€â”ˆâ•¯", f"âœ¦ {text} âœ¦", f"â™¡{text}â™¡",
        f"â§¼{text}â§½", f"âŸ¦{text}âŸ§", f"âœ¿ {text} âœ¿", f"â€¢ {text} â€¢", f"â«·{text}â«¸"
    ]
    fancy_map = {
        "a": "ğ’¶", "b": "ğ’·", "c": "ğ’¸", "d": "ğ’¹", "e": "ğ‘’", "f": "ğ’»", "g": "ğ‘”", "h": "ğ’½",
        "i": "ğ’¾", "j": "ğ’¿", "k": "ğ“€", "l": "ğ“", "m": "ğ“‚", "n": "ğ“ƒ", "o": "ğ‘œ", "p": "ğ“…",
        "q": "ğ“†", "r": "ğ“‡", "s": "ğ“ˆ", "t": "ğ“‰", "u": "ğ“Š", "v": "ğ“‹", "w": "ğ“Œ", "x": "ğ“",
        "y": "ğ“", "z": "ğ“"
    }
    fancy_text = "".join(fancy_map.get(c.lower(), c) for c in text)
    styles.append(f"ğŸŒŸ {fancy_text} ğŸŒŸ")
    return styles

def is_arabic(text: str) -> bool:
    return any('\u0600' <= c <= '\u06FF' for c in text)

WELCOME_MESSAGE = (
    "âœ¨ *Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø¨ÙˆØª Ø§Ù„Ø²Ø®Ø±ÙØ© Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ!* âœ¨\n\n"
    "ğŸ–‹ï¸ Ù‡Ø°Ø§ Ø§Ù„Ø¨ÙˆØª Ù…ØªØ®ØµØµ Ø¨Ø²Ø®Ø±ÙØ© Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ÙˆØ§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©!\n"
    "ğŸ’¬ ÙÙ‚Ø· Ø£Ø±Ø³Ù„ Ù„ÙŠ Ø£ÙŠ ÙƒÙ„Ù…Ø©ØŒ ÙˆØ³Ø£Ø²Ø®Ø±ÙÙ‡Ø§ Ù„Ùƒ Ø¨Ø£Ù†Ù…Ø§Ø· Ø±Ø§Ø¦Ø¹Ø©.\n\n"
    f"ğŸ“¢ *Ù‚Ø¨Ù„ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙˆØªØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙÙŠ Ø§Ù„Ù‚Ù†Ø§Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©:* {CHANNEL_USERNAME}"
)

USAGE_GUIDE = (
    "âœ… *ØªÙ… Ø§Ù„ØªÙØ¹ÙŠÙ„!*\n\n"
    "âœï¸ Ø£Ø±Ø³Ù„ Ø£ÙŠ ÙƒÙ„Ù…Ø© Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø£Ùˆ Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©\n"
    "ğŸ¨ ÙˆØ³ØªØµÙ„Ùƒ 15 Ø²Ø®Ø±ÙØ© Ø¬Ù…ÙŠÙ„Ø©\n"
    "ğŸ“Œ ÙÙ‚Ø· Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø®Ø±ÙØ© Ù„Ù†Ø³Ø®Ù‡Ø§!"
)

async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    user_id = update.effective_user.id
    bot = context.bot
    if not await is_user_subscribed(bot, user_id):
        await update.message.reply_text(WELCOME_MESSAGE, parse_mode="Markdown")
    else:
        await update.message.reply_text(USAGE_GUIDE, parse_mode="Markdown")

async def handle_message(update: Update, context: ContextTypes.DEFAULT_TYPE):
    user_id = update.effective_user.id
    bot = context.bot
    text = update.message.text

    if not text:
        return

    if not await is_user_subscribed(bot, user_id):
        await update.message.reply_text(
            f"âš ï¸ ÙŠØ¬Ø¨ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙÙŠ Ø§Ù„Ù‚Ù†Ø§Ø© Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙˆØª:\n{CHANNEL_USERNAME}"
        )
        return

    decorations = decorate_arabic(text) if is_arabic(text) else decorate_english(text)
    keyboard = [[InlineKeyboardButton(txt, callback_data=txt)] for txt in decorations]
    await update.message.reply_text(
        "ğŸ‘‡ Ø§Ø®ØªØ± Ø§Ù„Ø²Ø®Ø±ÙØ© Ø§Ù„ØªÙŠ ØªØ¹Ø¬Ø¨ÙƒØŒ Ø§Ø¶ØºØ· Ù„Ù†Ø³Ø®Ù‡Ø§:",
        reply_markup=InlineKeyboardMarkup(keyboard)
    )

async def handle_button(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    await query.answer()
    await query.message.reply_text(f"âœ… ØªÙ… Ø§Ù„Ù†Ø³Ø®:\n{query.data}")

def main():
    app = ApplicationBuilder().token(TOKEN).build()
    app.add_handler(CommandHandler("start", start))
    app.add_handler(CallbackQueryHandler(handle_button))
    app.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, handle_message))
    print("âœ… Ø¨ÙˆØª Ø§Ù„Ø²Ø®Ø±ÙØ© ÙŠØ¹Ù…Ù„ Ø§Ù„Ø¢Ù†...")
    app.run_polling()

if __name__ == "__main__":
    main()
